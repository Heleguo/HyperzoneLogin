# 入口

统一接入

## 入口流程

取入口表中数据，看是否存在并进行校验，校验成功（name和uuid必须一致）则登入成功，不成功则继续处理。

首先进行取 pid（游戏内档案ID）操作，根据不同情况处理：

### 情况 1：档案不存在

同时在对应入口表和游戏内档案表创建对应条目并建立映射

### 情况 2：档案存在且与当前渠道对应

登入完成

### 情况 3：档案存在但与当前渠道不同（复杂情况）

渠道不同的判定：渠道表中不存在
此情况下又存在多个子情况

#### 情况 3.1：存在离线账户

提示用户进行密码验证。
验证密码成功后在对应入口表建立新条目并指向映射。

#### 情况 3.2：不存在离线账户

提出并表示需要先创建离线账户才能绑定多个账户

### 情况 4：校验失败，name和uuid对不上（皮肤站尝试更新）

不为玩家进行更新，并修改数据条目，将name修改为皮肤中的新name，并给玩家提醒，若需要修改名称，需要通过命令进行（后续完善，避免这里过度设计）  

## 数据库结构

使用String定义入口ID，并且要求全小写，并作为表名的一部分，如{自定义Prefix}_hyperzone_login_incom_{入口ID}

内置类型特殊约定：

- Mojang，官方，约定为mojang （避免使用online容易混淆）
- Offline，离线，约定为offline

### 入口表结构

| 字段名  | 数据类型    | 用途           | 特殊 |
|------|---------|--------------|----|
| id   | 自增int   | 标记数据         |    |
| name | varchar | 入口处的玩家名      |    |
| uuid | uuid    | 入口处的uuid     |    |
| pid  | uuid    | 映射profile的id | 外键 |

# 游戏内档案

## 新服

统一采用基于name的哈希算法生成UUID

## 老服务器

进行导入，未注册的使用和新服一样的算法

## 数据表结构

name和UUID需要保持整个库中无重复

| 字段名  | 数据类型    | 用途         | 特殊 |
|------|---------|------------|----|
| id   | UUID    | 用作和入口关联的映射 | 主键 |
| name | varchar | 游戏内名称      |    |
| uuid | UUID    | 游戏内UUID    |    |  

取id的操作：同时传入name和uuid，采用or的方式，返回所有条目，limit 1。